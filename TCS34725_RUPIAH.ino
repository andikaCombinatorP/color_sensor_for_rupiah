#include <Wire.h>
#include <Adafruit_TCS34725.h>

Adafruit_TCS34725 tcs = Adafruit_TCS34725(TCS34725_INTEGRATIONTIME_50MS, TCS34725_GAIN_1X);

// Definisi RGB untuk uang Seribu, Lima Ribu, Dua Ribuan, Dua Puluh Ribu, Lima Puluh Ribu, Sepuluh Ribu, dan Seratus Ribu (40 warna masing-masing)
uint16_t uangColors[7][40][3] = {
  // Definisi warna untuk uang Seribu (indeks 0-39)
  {
{160, 225, 186},
  {189, 260, 177},
  {154, 219, 158},
  {131, 191, 143},
  {123, 181, 136},
  {303, 412, 280},
  {312, 443, 299},
  {314, 445, 300},
  {326, 455, 305},
  {335, 467, 312},
  {335, 468, 313},
  {335, 470, 314},
  {333, 456, 305},
  {323, 431, 290},
  {325, 433, 292},
  {335, 459, 308},
  {336, 463, 310},
  {340, 473, 316},
  {344, 481, 321},
  {345, 486, 324},
  {345, 487, 325},
  {345, 488, 326},
  {345, 488, 325},
  {325, 458, 306},
  {331, 460, 306},
  {310, 431, 281},
  {302, 422, 278},
  {291, 416, 274},
  {261, 368, 249},
  {243, 335, 229},
  {183, 254, 178},
  {98, 154, 115},
  {185, 228, 159},
  {472, 549, 335},
  {590, 725, 427},
  {419, 525, 341},
  {317, 446, 300},


  },
  // Definisi warna untuk uang Lima Ribu (indeks 0-39)
  {
   {516, 685, 386},
  {513, 682, 384},
  {498, 669, 376},
  {477, 647, 364},
  {488, 659, 370},
  {487, 658, 367},
  {496, 717, 361},
  {505, 712, 360},
  {473, 637, 379},
  {469, 579, 379},
  {377, 518, 304},
  {359, 460, 295},
  {399, 491, 335},
  {369, 438, 305},
  {352, 416, 291},
  {368, 435, 300},
  {353, 420, 291},
  {346, 414, 287},
  {338, 407, 287},
  {342, 408, 284},
  {338, 404, 282},
  {349, 414, 288},
  {388, 473, 325},
  {364, 451, 311},
  {362, 449, 309},
  {372, 460, 317},
  {377, 465, 320},
  {381, 468, 322},
  {390, 476, 327},
  {447, 546, 366},
  {413, 489, 327},
  {291, 343, 239},
  {405, 497, 317},
  {589, 740, 428},
  {614, 765, 433},
  {646, 765, 426},
  {670, 737, 410},
  {646, 717, 399},
  {659, 725, 403},
  {677, 725, 404},
  {680, 727, 405},
  {659, 715, 397},
  {661, 716, 397},
  {653, 711, 394},
  {636, 707, 393},
  {613, 770, 432},
  {540, 701, 407},
  {253, 306, 219},
  {311, 379, 268},
  {330, 387, 274},
  {406, 493, 336},
  {499, 610, 394},


  },
  // Definisi warna untuk uang Dua Ribuan (indeks 0-39)
  {
     {722, 984, 656},
  {707, 975, 648},
  {690, 963, 638},
  {814, 1109, 730},
  {240, 395, 285},
  {389, 607, 421},
  {519, 781, 537},
  {506, 765, 526},
  {305, 504, 357},
  {341, 556, 399},
  {474, 755, 546},
  {480, 761, 550},
  {424, 686, 484},
  {490, 778, 551},
  {482, 769, 544},
  {500, 788, 559},
  {501, 789, 559},
  {514, 801, 568},
  {509, 797, 566},
  {518, 804, 571},
  {528, 811, 577},
  {518, 805, 572},
  {508, 797, 565},
  {501, 790, 560},
  {512, 800, 568},
  {103, 158, 127},
  {66, 116, 100},
  {69, 121, 99},
  {74, 124, 108},
  {78, 127, 112},
  {80, 130, 115},
  {200, 294, 243},
  {318, 425, 343},


  },
  // Definisi warna untuk uang Dua Puluh Ribu (indeks 0-39)
  {
    {418, 715, 515},
  {416, 714, 514},
  {420, 717, 516},
  {418, 715, 514},
  {401, 702, 505},
  {360, 656, 471},
  {326, 606, 435},
  {333, 616, 443},
  {383, 690, 496},
  {403, 728, 516},
  {394, 694, 487},
  {428, 740, 521},
  {452, 753, 531},
  {538, 827, 579},
  {569, 853, 598},
  {513, 790, 555},
  {421, 660, 450},
  {399, 638, 430},
  {402, 640, 432},
  {403, 640, 430},
  {327, 533, 349},
  {286, 474, 319},
  {281, 472, 318},
  {227, 392, 264},
  {291, 479, 324},
  {486, 732, 488},
  {514, 760, 504},
  {370, 587, 388},
  {362, 588, 382},
  {400, 652, 414},
  {397, 658, 414},
  {358, 610, 384},
  {352, 604, 380},
  {355, 606, 381},
  {358, 609, 383},
  {395, 647, 407},
  {354, 591, 364},
  {433, 696, 430},
  {525, 841, 506},
  {606, 895, 559},
  {668, 967, 606},
  {653, 959, 601},
  {632, 942, 588},


  },
  // Definisi warna untuk uang Lima Puluh Ribu (indeks 0-39)
  {
 {516, 685, 386},
  {513, 682, 384},
  {498, 669, 376},
  {477, 647, 364},
  {488, 659, 370},
  {487, 658, 367},
  {496, 717, 361},
  {505, 712, 360},
  {473, 637, 379},
  {469, 579, 379},
  {377, 518, 304},
  {359, 460, 295},
  {399, 491, 335},
  {369, 438, 305},
  {352, 416, 291},
  {368, 435, 300},
  {353, 420, 291},
  {346, 414, 287},
  {338, 407, 287},
  {342, 408, 284},
  {338, 404, 282},
  {349, 414, 288},
  {388, 473, 325},
  {364, 451, 311},
  {362, 449, 309},
  {372, 460, 317},
  {377, 465, 320},
  {381, 468, 322},
  {390, 476, 327},
  {447, 546, 366},
  {413, 489, 327},
  {291, 343, 239},
  {405, 497, 317},
  {589, 740, 428},
  {614, 765, 433},
  {646, 765, 426},
  {670, 737, 410},
  {646, 717, 399},
  {659, 725, 403},
  {677, 725, 404},
  {680, 727, 405},
  {659, 715, 397},
  {661, 716, 397},
  {653, 711, 394},
  {636, 707, 393},
  {613, 770, 432},
  {540, 701, 407},
  {253, 306, 219},
  {311, 379, 268},
  {330, 387, 274},
  {406, 493, 336},
  {499, 610, 394},


  },
  // Definisi warna untuk uang Sepuluh Ribu (indeks 0-39)
  {
   {357, 433, 299},
  {357, 433, 299},
  {355, 432, 298},
  {355, 431, 297},
  {355, 431, 297},
  {358, 434, 299},
  {352, 429, 296},
  {361, 449, 342},
  {289, 371, 294},
  {305, 388, 307},
  {349, 453, 336},
  {350, 455, 337},
  {361, 464, 344},
  {351, 453, 337},
  {314, 405, 313},
  {253, 334, 272},
  {256, 337, 273},
  {269, 354, 284},
  {280, 358, 285},
  {285, 363, 288},
  {288, 367, 291},
  {273, 355, 284},
  {268, 349, 280},
  {283, 365, 291},
  {179, 246, 212},
  {178, 245, 211},
  {205, 272, 231},
  {310, 401, 289},
  {365, 466, 328},
  {371, 474, 330},


  },
  // Definisi warna untuk uang Seratus Ribu (indeks 0-39)
  {
 {261, 267, 218},
    {414, 405, 318},
    {610, 602, 460},
    {551, 552, 431},
    {445, 448, 356},
    {419, 402, 319},
    {600, 581, 445},
    {265, 273, 218},
    {601, 616, 469},
    {566, 588, 452},
    {345, 340, 272},
    {415, 421, 327},
    {383, 371, 291},
    {385, 401, 305},
    {378, 532, 360},
    {383, 525, 321},
    {357, 480, 300},
    {340, 385, 282},
    {420, 472, 354},
    {440, 496, 367},
    {347, 408, 282},
    {326, 395, 256},
    {317, 386, 250},
    {307, 379, 246},
    {330, 397, 256},
    {409, 454, 340},
    {360, 410, 313},
    {369, 505, 346},
    {377, 370, 291},


  }
};

uint16_t countMatches[6][30] = {0}; // Menghitung jumlah cocokan untuk setiap definisi warna uang (40 warna masing-masing)

void setup() {
  Wire.begin();
  Serial.begin(9600);

  if (tcs.begin()) {
    Serial.println("Sensor warna TCS34725 ditemukan.");
  } else {
    Serial.println("Tidak dapat menemukan sensor warna TCS34725. Periksa koneksi!");
    while (1);
  }
}

void loop() {
  uint16_t clear, red, green, blue;
  tcs.getRawData(&red, &green, &blue, &clear);

  // Bandingkan nilai RGB dengan definisi-definisi uang
  for (int i = 0; i < 7; i++) {
    for (int j = 0; j < 30; j++) {
      if (red >= uangColors[i][j][0] && red <= uangColors[i][j][0] + 30 &&
          green >= uangColors[i][j][1] && green <= uangColors[i][j][1] + 30 &&
          blue >= uangColors[i][j][2] && blue <= uangColors[i][j][2] + 30) {
        countMatches[i][j]++;
      } else {
        countMatches[i][j] = 0;
      }

      // Cek jika terdapat cocokan sebanyak 10 kali, maka cetak nilai uang
      if (countMatches[i][j] >= 10) {
        Serial.print("Uang terdeteksi: Denominasi ");
        if (i == 0) {
          Serial.print("Seribu");
        } else if (i == 1) {
          Serial.print("Lima Ribu");
        } else if (i == 2) {
          Serial.print("Dua Ribuan");
        } else if (i == 3) {
          Serial.print("Dua Puluh Ribu");
        } else if (i == 4) {
          Serial.print("Lima Puluh Ribu");
        } else if (i == 5) {
          Serial.print("Sepuluh Ribu");
        } else if (i == 6) {
          Serial.print("Seratus Ribu");
        }
        Serial.print(", Definisi ke-");
        Serial.println(j + 1);
        countMatches[i][j] = 0;  // Reset hitungan cocokan
      }
    }
  }
  delay(50);
}
